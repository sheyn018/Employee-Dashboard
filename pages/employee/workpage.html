<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Work Page - HR Connect</title>
  <link rel="stylesheet" href="../../components/navigation.css">
  <style>
    body {
      margin: 0;
      padding: 0;
      min-height: 100vh;
      /* Softer gradient (light green + light blue + white) */
      background: linear-gradient(135deg, #d4fc79, #96e6a1, #a1c4fd, #c2e9fb);
      background-size: 400% 400%;
      animation: gradientFloat 12s ease infinite;
      font-family: Arial, sans-serif;
      color: #333;
    }

    @keyframes gradientFloat {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .work-container {
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      text-align: center;
      animation: floatBox 4s ease-in-out infinite;
      margin-top: 80px; /* Add spacing for navigation buttons */
    }

    @keyframes floatBox {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-8px); }
    }

    .task-container {
      background: rgba(255, 255, 255, 0.95);
      padding: 30px;
      border-radius: 15px;
      margin-bottom: 20px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .stats-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: rgba(255, 255, 255, 0.95);
      padding: 15px;
      border-radius: 10px;
      text-align: center;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }

    .stat-card h3 {
      margin: 0;
      font-size: 16px;
      color: #333;
      font-weight: 600;
    }

    .stat-card p {
      margin: 10px 0 0;
      font-size: 24px;
      font-weight: bold;
      color: #2c3e50;
    }

    #wordToType {
      font-size: 28px;
      margin: 20px 0;
      padding: 20px;
      background: rgba(44, 62, 80, 0.9);
      color: white;
      border-radius: 10px;
      font-weight: bold;
      letter-spacing: 1px;
    }

    .input-field {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      border: 2px solid #e0e0e0;
      border-radius: 5px;
      font-size: 18px;
      background: white;
      color: #333;
      transition: border-color 0.3s ease;
    }

    .input-field:focus {
      border-color: #4CAF50;
      outline: none;
    }

    .result {
      margin: 15px 0;
      font-size: 18px;
      color: #2c3e50;
      font-weight: 500;
    }

    .done-btn {
      background-color: #4CAF50;
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 20px;
      transition: background-color 0.3s ease;
    }

    .done-btn:hover {
      background-color: #45a049;
    }

    .timer {
      font-size: 20px;
      margin: 10px 0;
      color: #2c3e50;
      font-weight: 500;
    }

    .speed-indicator {
      font-size: 18px;
      margin: 10px 0;
      color: #4CAF50;
      font-weight: 600;
    }

    h2 {
      color: #2c3e50;
      margin-bottom: 20px;
      font-size: 24px;
      font-weight: bold;
    }

    p {
      color: #34495e;
      font-size: 16px;
      line-height: 1.5;
    }
  </style>
</head>
<body>
  <div id="navigation-container"></div>
  
  <div class="work-container">
    <div class="stats-container">
      <div class="stat-card">
        <h3>Current Earnings</h3>
        <p>‚Ç±<span id="currentEarnings">0</span></p>
      </div>
      <div class="stat-card">
        <h3>Words Written</h3>
        <p><span id="currentWordCount">0</span></p>
      </div>
      <div class="stat-card">
        <h3>Tasks Completed</h3>
        <p><span id="tasksCompleted">0</span></p>
      </div>
      <div class="stat-card">
        <h3>Average Speed</h3>
        <p><span id="avgSpeed">0</span> WPM</p>
      </div>
    </div>

    <div class="task-container">
      <h2>üìù Typing Challenge</h2>
      <p>Type the following word as quickly as you can:</p>
      
      <div id="wordToType">Loading word...</div>
      <div class="timer">Time: <span id="timer">0.0</span>s</div>
      <div class="speed-indicator" id="speedIndicator"></div>

      <input type="text" id="typedWord" class="input-field" placeholder="Start typing here..." oninput="checkTyping()" autofocus />
      
      <div id="taskStatus" class="result"></div>
      <div id="earningsDisplay" class="result">Total Earnings: ‚Ç±0</div>
    </div>

    <button class="done-btn" onclick="doneWorking()">Done Working</button>
  </div>

  <script>
    const words = [
      "apple", "banana", "orange", "grape", "cherry", "strawberry", "blueberry", "kiwi", "mango", "pear",
      "computer", "keyboard", "javascript", "employee", "task", "challenge", "work", "office", "success", "team"
    ];

    const employee = JSON.parse(localStorage.getItem("loggedInEmployee"));
    if (!employee) {
      window.location.href = "../login.html";
    }

    const key = `${employee.name}_data`;
    let storedData = JSON.parse(localStorage.getItem(key)) || {
      earnings: 0,
      wordCount: 0,
      tasksCompleted: 0,
      avgSpeed: 0,
      totalSpeed: 0
    };

    let earnings = 0;
    let wordCount = 0;
    let startTime = 0;
    let speedSum = 0;
    let tasksCompleted = storedData.tasksCompleted || 0;

    function loadRandomWord() {
      const randomWord = words[Math.floor(Math.random() * words.length)];
      document.getElementById("wordToType").textContent = randomWord;
      startTime = Date.now();
      document.getElementById("timer").textContent = "0.0";
      document.getElementById("speedIndicator").textContent = "";
      startTimer();
    }

    let timerInterval;
    function startTimer() {
      clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        const elapsed = ((Date.now() - startTime) / 1000).toFixed(1);
        document.getElementById("timer").textContent = elapsed;
      }, 100);
    }

    function calculateWPM(word, timeInSeconds) {
      const wordsPerMinute = (word.length / 5) / (timeInSeconds / 60);
      return Math.round(wordsPerMinute);
    }

    function updateDisplay() {
      document.getElementById("currentEarnings").textContent = storedData.earnings + earnings;
      document.getElementById("currentWordCount").textContent = storedData.wordCount + wordCount;
      document.getElementById("tasksCompleted").textContent = tasksCompleted;
      const displaySpeed = storedData.avgSpeed || (tasksCompleted > 0 ? Math.round(speedSum / tasksCompleted) : 0);
      document.getElementById("avgSpeed").textContent = displaySpeed;
      document.getElementById("earningsDisplay").textContent = `Current Session Earnings: ‚Ç±${earnings}`;
    }

    function checkTyping() {
      const typedText = document.getElementById("typedWord").value;
      const wordToType = document.getElementById("wordToType").textContent;
      const taskStatus = document.getElementById("taskStatus");

      if (typedText === wordToType) {
        clearInterval(timerInterval);
        const timeElapsed = (Date.now() - startTime) / 1000;
        const wpm = calculateWPM(wordToType, timeElapsed);
        speedSum += wpm;
        tasksCompleted++;

        document.getElementById("speedIndicator").textContent = `Speed: ${wpm} WPM`;
        taskStatus.textContent = "Correct! Get ready for the next word...";
        taskStatus.style.color = "green";

        earnings += 100;
        wordCount++;

        document.getElementById("typedWord").value = "";
        updateDisplay();
        setTimeout(loadRandomWord, 1500);
      } else {
        taskStatus.textContent = "Keep going!";
        taskStatus.style.color = "#ff9800";
      }
    }

    function saveProgress() {
      storedData.earnings += earnings;
      storedData.wordCount += wordCount;
      storedData.tasksCompleted = tasksCompleted;
      storedData.totalSpeed = speedSum;
      storedData.avgSpeed = Math.round(speedSum / tasksCompleted);
      localStorage.setItem(key, JSON.stringify(storedData));

      let records = JSON.parse(localStorage.getItem("employeeRecords")) || [];
      const index = records.findIndex(r => r.name === employee.name);
      if (index !== -1) {
        records[index].earnings = storedData.earnings;
        records[index].wordCount = storedData.wordCount;
        records[index].tasksCompleted = storedData.tasksCompleted;
        records[index].avgSpeed = storedData.avgSpeed;
      } else {
        records.push({
          name: employee.name,
          position: employee.position,
          earnings: storedData.earnings,
          wordCount: storedData.wordCount,
          tasksCompleted: storedData.tasksCompleted,
          avgSpeed: storedData.avgSpeed,
          date: new Date().toLocaleDateString(),
          timeIn: "N/A",
          timeOut: "N/A"
        });
      }
      localStorage.setItem("employeeRecords", JSON.stringify(records));

      let earningSummary = JSON.parse(localStorage.getItem("earningSummary")) || [];
      const summaryIndex = earningSummary.findIndex(e => e.name === employee.name);
      if (summaryIndex !== -1) {
        earningSummary[summaryIndex].earnings = storedData.earnings;
        earningSummary[summaryIndex].wordCount = storedData.wordCount;
        earningSummary[summaryIndex].tasksCompleted = storedData.tasksCompleted;
        earningSummary[summaryIndex].avgSpeed = storedData.avgSpeed;
      } else {
        earningSummary.push({
          name: employee.name,
          earnings: storedData.earnings,
          wordCount: storedData.wordCount,
          tasksCompleted: storedData.tasksCompleted,
          avgSpeed: storedData.avgSpeed
        });
      }
      localStorage.setItem("earningSummary", JSON.stringify(earningSummary));
    }

    function doneWorking() {
      saveProgress();
      alert("Work session complete. Progress saved.");
      window.location.href = "profile.html";
    }

    window.onload = () => {
      loadRandomWord();
      updateDisplay();
    };
  </script>
  
  <script>
    // Disable auto-initialization - MUST be set before loading navigation.js
    window.NavigationComponent_AutoInit = false;
  </script>
  <script src="../../components/navigation.js"></script>
  <script>
    // Initialize navigation for employee
    NavigationComponent.init({
      menuType: 'employee',
      includeLogout: true,
      authCheck: true
    });
    
    // Set active navigation item
    NavigationComponent.setActiveNavItem('workpage.html');
  </script>
</body>
</html>



