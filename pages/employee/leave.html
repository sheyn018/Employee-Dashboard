<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Leave Management</title>
  <link rel="stylesheet" href="../assets/css/style.css">
  <link rel="stylesheet" href="../../css/modules.css">
  <link rel="stylesheet" href="../../components/navigation.css">
</head>
<body>
<div id="navigation-container"></div>

<div class="container">
  <h2>üèñÔ∏è Leave Management</h2>
  <form id="leaveForm">
    <label>Employee ID</label>
    <input type="number" name="employee_id" required>
    <label>Leave Type</label>
    <select name="leave_type" required>
      <option value="Sick Leave">Sick Leave</option>
      <option value="Vacation Leave">Vacation Leave</option>
      <option value="Emergency Leave">Emergency Leave</option>
    </select>
    <label>Start Date</label>
    <input type="date" name="start_date" required>
    <label>End Date</label>
    <input type="date" name="end_date" required>
    <label>Reason</label>
    <textarea name="reason"></textarea>
    <button type="submit">Submit Leave</button>
  </form>

  <h3>Leave Records</h3>
  <table id="leaveTable">
    <thead>
      <tr>
        <th>ID</th>
        <th>Employee</th>
        <th>Type</th>
        <th>Duration</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
document.getElementById("leaveForm").addEventListener("submit", async function(e){
  e.preventDefault();
  let formData = new FormData(this);
  let res = await fetch("../api/api.php?action=add_leave", { method: "POST", body: formData });
  let data = await res.json();
  alert(data.message);
  loadData();
});

async function loadData(){
  let res = await fetch("../api/api.php?action=get_leaves");
  let data = await res.json();
  let tbody = document.querySelector("#leaveTable tbody");
  tbody.innerHTML = "";
  data.data.forEach(row => {
    tbody.innerHTML += `<tr>
      <td>${row.id}</td>
      <td>${row.employee_id}</td>
      <td>${row.leave_type}</td>
      <td>${row.start_date} to ${row.end_date}</td>
      <td>${row.status}</td>
    </tr>`;
  });
}
loadData();
</script>

<script>
  // Disable auto-initialization - MUST be set before loading navigation.js
  window.NavigationComponent_AutoInit = false;
</script>
<script src="../../components/navigation.js"></script>
<script>
  // Initialize navigation for employee
  NavigationComponent.init({
    menuType: 'employee',
    includeLogout: true,
    authCheck: true
  });
  
  // Set active navigation item
  NavigationComponent.setActiveNavItem('leave.html');
</script>
</body>
</html>



